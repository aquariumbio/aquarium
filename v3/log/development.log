Started POST "/api/v3/token/get_user" for 172.19.0.7 at 2020-11-05 13:56:41 -0800
  [1m[35m (0.8ms)[0m  [1m[35mSET NAMES utf8,  @@SESSION.sql_mode = CONCAT(CONCAT(@@sql_mode, ',STRICT_ALL_TABLES'), ',NO_AUTO_VALUE_ON_ZERO'),  @@SESSION.sql_auto_is_null = 0, @@SESSION.wait_timeout = 2147483[0m
Processing by Api::V3::TokenController#get_user as HTML
  Parameters: {"token"=>"76831972757892c23e4fa3c908d46fb3ca43e3f55c2a894401fc223294cb8e8e6cf75690cd1c614803f673d1e94377bd69b07609664f62cb47c9c5f677ae8766"}
  [1m[36mUser Load (16.6ms)[0m  [1m[34m
        select ut.*, u.name, u.login, u.permission_ids
        from user_tokens ut
        inner join users u on u.id = ut.user_id
        where ut.token = '76831972757892c23e4fa3c908d46fb3ca43e3f55c2a894401fc223294cb8e8e6cf75690cd1c614803f673d1e94377bd69b07609664f62cb47c9c5f677ae8766' and ut.ip = '172.19.0.7'
        limit 1
      [0m
  â†³ app/models/user.rb:20:in `validate_token'
Completed 200 OK in 30ms (Views: 0.1ms | ActiveRecord: 18.1ms | Allocations: 2116)


Started POST "/api/v3/token/get_user" for 172.19.0.7 at 2020-11-05 13:56:43 -0800
Processing by Api::V3::TokenController#get_user as HTML
  Parameters: {"token"=>"76831972757892c23e4fa3c908d46fb3ca43e3f55c2a894401fc223294cb8e8e6cf75690cd1c614803f673d1e94377bd69b07609664f62cb47c9c5f677ae8766"}
  [1m[36mUser Load (0.8ms)[0m  [1m[34m
        select ut.*, u.name, u.login, u.permission_ids
        from user_tokens ut
        inner join users u on u.id = ut.user_id
        where ut.token = '76831972757892c23e4fa3c908d46fb3ca43e3f55c2a894401fc223294cb8e8e6cf75690cd1c614803f673d1e94377bd69b07609664f62cb47c9c5f677ae8766' and ut.ip = '172.19.0.7'
        limit 1
      [0m
  â†³ app/models/user.rb:20:in `validate_token'
Completed 200 OK in 4ms (Views: 0.1ms | ActiveRecord: 0.8ms | Allocations: 663)


Started POST "/api/v3/permissions/get_permissions" for 172.19.0.7 at 2020-11-05 13:56:49 -0800
Processing by Api::V3::PermissionsController#get_permissions as HTML
  Parameters: {"token"=>"faf4281b98d2561e9d23086cd08c1329e9812e51c48ba268984ff960c33782730bd1bfcb807bb5c5e073c1a79fe75583933be95d2ea5da462734d9b64b9256a2"}
  [1m[36mUser Load (0.9ms)[0m  [1m[34m
        select ut.*, u.name, u.login, u.permission_ids
        from user_tokens ut
        inner join users u on u.id = ut.user_id
        where ut.token = 'faf4281b98d2561e9d23086cd08c1329e9812e51c48ba268984ff960c33782730bd1bfcb807bb5c5e073c1a79fe75583933be95d2ea5da462734d9b64b9256a2' and ut.ip = '172.19.0.7'
        limit 1
      [0m
  â†³ app/models/user.rb:20:in `validate_token'
Completed 200 OK in 5ms (Views: 0.1ms | ActiveRecord: 0.9ms | Allocations: 674)


Started POST "/api/v3/token/create" for 172.19.0.7 at 2020-11-05 13:57:00 -0800
Processing by Api::V3::TokenController#create as HTML
  Parameters: {"login"=>"neptune", "password"=>"[FILTERED]"}
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`login` = 'neptune' LIMIT 1[0m
  â†³ app/controllers/api/v3/token_controller.rb:7:in `create'
  [1m[36mUserToken Load (0.6ms)[0m  [1m[34mselect * from user_tokens where ip = '172.19.0.7' and token = '0e1467a6eb0a651b0713696d7039966af8e132f22173f1f9d31ba22fbf7808976128445141fe187c2af8959687ce85676ced262b70e4b6752b21521e3b550e75' limit 1[0m
  â†³ app/models/user_token.rb:12:in `new_token'
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  â†³ app/controllers/api/v3/token_controller.rb:24:in `create'
  [1m[36mUserToken Create (0.6ms)[0m  [1m[32mINSERT INTO `user_tokens` (`user_id`, `token`, `created_at`, `updated_at`, `ip`, `timenow`) VALUES (1, '0e1467a6eb0a651b0713696d7039966af8e132f22173f1f9d31ba22fbf7808976128445141fe187c2af8959687ce85676ced262b70e4b6752b21521e3b550e75', '2020-11-05 21:57:00', '2020-11-05 21:57:00', '172.19.0.7', '2020-11-05 21:57:00')[0m
  â†³ app/controllers/api/v3/token_controller.rb:24:in `create'
  [1m[35m (2.5ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/controllers/api/v3/token_controller.rb:24:in `create'
Completed 200 OK in 148ms (Views: 0.1ms | ActiveRecord: 11.8ms | Allocations: 13557)


Started POST "/api/v3/token/delete" for 172.19.0.7 at 2020-11-05 13:57:05 -0800
Processing by Api::V3::TokenController#delete as HTML
  Parameters: {"token"=>"0e1467a6eb0a651b0713696d7039966af8e132f22173f1f9d31ba22fbf7808976128445141fe187c2af8959687ce85676ced262b70e4b6752b21521e3b550e75", "all"=>"true"}
  [1m[36mUser Load (0.9ms)[0m  [1m[34mselect * from user_tokens where token = '0e1467a6eb0a651b0713696d7039966af8e132f22173f1f9d31ba22fbf7808976128445141fe187c2af8959687ce85676ced262b70e4b6752b21521e3b550e75' and ip = '172.19.0.7' limit 1[0m
  â†³ app/models/user.rb:52:in `sign_out'
  [1m[35m (2.6ms)[0m  [1m[31mdelete from user_tokens where user_id = 1[0m
  â†³ app/models/user.rb:57:in `sign_out'
Completed 200 OK in 10ms (Views: 0.1ms | ActiveRecord: 3.5ms | Allocations: 1058)


Started POST "/api/v3/token/get_user" for 172.19.0.7 at 2020-11-05 13:57:08 -0800
Processing by Api::V3::TokenController#get_user as HTML
  Parameters: {"token"=>"0e1467a6eb0a651b0713696d7039966af8e132f22173f1f9d31ba22fbf7808976128445141fe187c2af8959687ce85676ced262b70e4b6752b21521e3b550e75"}
  [1m[36mUser Load (1.0ms)[0m  [1m[34m
        select ut.*, u.name, u.login, u.permission_ids
        from user_tokens ut
        inner join users u on u.id = ut.user_id
        where ut.token = '0e1467a6eb0a651b0713696d7039966af8e132f22173f1f9d31ba22fbf7808976128445141fe187c2af8959687ce85676ced262b70e4b6752b21521e3b550e75' and ut.ip = '172.19.0.7'
        limit 1
      [0m
  â†³ app/models/user.rb:20:in `validate_token'
Completed 200 OK in 5ms (Views: 0.1ms | ActiveRecord: 1.0ms | Allocations: 655)


Started POST "/api/v3/token/create" for 172.19.0.7 at 2020-11-05 13:57:09 -0800
Processing by Api::V3::TokenController#create as HTML
  Parameters: {"login"=>"neptune", "password"=>"[FILTERED]"}
  [1m[36mUser Load (0.9ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`login` = 'neptune' LIMIT 1[0m
  â†³ app/controllers/api/v3/token_controller.rb:7:in `create'
  [1m[36mUserToken Load (0.6ms)[0m  [1m[34mselect * from user_tokens where ip = '172.19.0.7' and token = 'c656fb80045af9d1fa20104c55402a5f6cef05b9971e6d35f47409e46a767561b149e01821ef0cd96b55693b52581752cf98a4ea80ac6e106bc9714cf777a68e' limit 1[0m
  â†³ app/models/user_token.rb:12:in `new_token'
  [1m[35m (0.4ms)[0m  [1m[35mBEGIN[0m
  â†³ app/controllers/api/v3/token_controller.rb:24:in `create'
  [1m[36mUserToken Create (0.5ms)[0m  [1m[32mINSERT INTO `user_tokens` (`user_id`, `token`, `created_at`, `updated_at`, `ip`, `timenow`) VALUES (1, 'c656fb80045af9d1fa20104c55402a5f6cef05b9971e6d35f47409e46a767561b149e01821ef0cd96b55693b52581752cf98a4ea80ac6e106bc9714cf777a68e', '2020-11-05 21:57:09', '2020-11-05 21:57:09', '172.19.0.7', '2020-11-05 21:57:09')[0m
  â†³ app/controllers/api/v3/token_controller.rb:24:in `create'
  [1m[35m (1.0ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/controllers/api/v3/token_controller.rb:24:in `create'
Completed 200 OK in 111ms (Views: 0.1ms | ActiveRecord: 3.3ms | Allocations: 3530)


Started POST "/api/v3/token/get_user" for 172.19.0.7 at 2020-11-05 13:57:13 -0800
Processing by Api::V3::TokenController#get_user as HTML
  Parameters: {"token"=>"c656fb80045af9d1fa20104c55402a5f6cef05b9971e6d35f47409e46a767561b149e01821ef0cd96b55693b52581752cf98a4ea80ac6e106bc9714cf777a68e"}
  [1m[36mUser Load (1.0ms)[0m  [1m[34m
        select ut.*, u.name, u.login, u.permission_ids
        from user_tokens ut
        inner join users u on u.id = ut.user_id
        where ut.token = 'c656fb80045af9d1fa20104c55402a5f6cef05b9971e6d35f47409e46a767561b149e01821ef0cd96b55693b52581752cf98a4ea80ac6e106bc9714cf777a68e' and ut.ip = '172.19.0.7'
        limit 1
      [0m
  â†³ app/models/user.rb:20:in `validate_token'
  [1m[36mPermission Load (6.2ms)[0m  [1m[34mselect * from permissions order by sort, id[0m
  â†³ app/models/permission.rb:10:in `block in permission_ids'
  [1m[35m (1.5ms)[0m  [1m[33mupdate user_tokens ut set timenow = '2020-11-05 21:57:13' where ut.token = 'c656fb80045af9d1fa20104c55402a5f6cef05b9971e6d35f47409e46a767561b149e01821ef0cd96b55693b52581752cf98a4ea80ac6e106bc9714cf777a68e' and ut.ip = '172.19.0.7' limit 1[0m
  â†³ app/models/user.rb:38:in `validate_token'
Completed 200 OK in 42ms (Views: 0.2ms | ActiveRecord: 11.9ms | Allocations: 5923)


Started POST "/api/v3/permissions/get_permissions" for 172.19.0.7 at 2020-11-05 13:57:17 -0800
Processing by Api::V3::PermissionsController#get_permissions as HTML
  Parameters: {"token"=>"c656fb80045af9d1fa20104c55402a5f6cef05b9971e6d35f47409e46a767561b149e01821ef0cd96b55693b52581752cf98a4ea80ac6e106bc9714cf777a68e"}
  [1m[36mUser Load (0.9ms)[0m  [1m[34m
        select ut.*, u.name, u.login, u.permission_ids
        from user_tokens ut
        inner join users u on u.id = ut.user_id
        where ut.token = 'c656fb80045af9d1fa20104c55402a5f6cef05b9971e6d35f47409e46a767561b149e01821ef0cd96b55693b52581752cf98a4ea80ac6e106bc9714cf777a68e' and ut.ip = '172.19.0.7'
        limit 1
      [0m
  â†³ app/models/user.rb:20:in `validate_token'
  [1m[36mPermission Load (0.8ms)[0m  [1m[34mselect * from permissions order by sort, id[0m
  â†³ app/models/permission.rb:10:in `block in permission_ids'
  [1m[35m (1.7ms)[0m  [1m[33mupdate user_tokens ut set timenow = '2020-11-05 21:57:17' where ut.token = 'c656fb80045af9d1fa20104c55402a5f6cef05b9971e6d35f47409e46a767561b149e01821ef0cd96b55693b52581752cf98a4ea80ac6e106bc9714cf777a68e' and ut.ip = '172.19.0.7' limit 1[0m
  â†³ app/models/user.rb:38:in `validate_token'
Completed 200 OK in 14ms (Views: 0.2ms | ActiveRecord: 3.4ms | Allocations: 1777)


Started POST "/api/v3/users/set_permission" for 172.19.0.7 at 2020-11-05 13:57:22 -0800
Processing by Api::V3::UsersController#set_permission as HTML
  Parameters: {"token"=>"c656fb80045af9d1fa20104c55402a5f6cef05b9971e6d35f47409e46a767561b149e01821ef0cd96b55693b52581752cf98a4ea80ac6e106bc9714cf777a68e", "user_id"=>"1", "permission_id"=>"1"}
  [1m[36mUser Load (0.8ms)[0m  [1m[34m
        select ut.*, u.name, u.login, u.permission_ids
        from user_tokens ut
        inner join users u on u.id = ut.user_id
        where ut.token = 'c656fb80045af9d1fa20104c55402a5f6cef05b9971e6d35f47409e46a767561b149e01821ef0cd96b55693b52581752cf98a4ea80ac6e106bc9714cf777a68e' and ut.ip = '172.19.0.7'
        limit 1
      [0m
  â†³ app/models/user.rb:20:in `validate_token'
  [1m[36mPermission Load (0.6ms)[0m  [1m[34mselect * from permissions order by sort, id[0m
  â†³ app/models/permission.rb:10:in `block in permission_ids'
  [1m[35m (1.3ms)[0m  [1m[33mupdate user_tokens ut set timenow = '2020-11-05 21:57:22' where ut.token = 'c656fb80045af9d1fa20104c55402a5f6cef05b9971e6d35f47409e46a767561b149e01821ef0cd96b55693b52581752cf98a4ea80ac6e106bc9714cf777a68e' and ut.ip = '172.19.0.7' limit 1[0m
  â†³ app/models/user.rb:38:in `validate_token'
Completed 200 OK in 12ms (Views: 0.1ms | ActiveRecord: 2.7ms | Allocations: 1703)


Started POST "/api/v3/users/set_permission" for 172.19.0.7 at 2020-11-05 13:57:25 -0800
Processing by Api::V3::UsersController#set_permission as HTML
  Parameters: {"token"=>"c656fb80045af9d1fa20104c55402a5f6cef05b9971e6d35f47409e46a767561b149e01821ef0cd96b55693b52581752cf98a4ea80ac6e106bc9714cf777a68e", "user_id"=>"1", "permission_id"=>"2"}
  [1m[36mUser Load (0.9ms)[0m  [1m[34m
        select ut.*, u.name, u.login, u.permission_ids
        from user_tokens ut
        inner join users u on u.id = ut.user_id
        where ut.token = 'c656fb80045af9d1fa20104c55402a5f6cef05b9971e6d35f47409e46a767561b149e01821ef0cd96b55693b52581752cf98a4ea80ac6e106bc9714cf777a68e' and ut.ip = '172.19.0.7'
        limit 1
      [0m
  â†³ app/models/user.rb:20:in `validate_token'
  [1m[36mPermission Load (0.7ms)[0m  [1m[34mselect * from permissions order by sort, id[0m
  â†³ app/models/permission.rb:10:in `block in permission_ids'
  [1m[35m (1.8ms)[0m  [1m[33mupdate user_tokens ut set timenow = '2020-11-05 21:57:25' where ut.token = 'c656fb80045af9d1fa20104c55402a5f6cef05b9971e6d35f47409e46a767561b149e01821ef0cd96b55693b52581752cf98a4ea80ac6e106bc9714cf777a68e' and ut.ip = '172.19.0.7' limit 1[0m
  â†³ app/models/user.rb:38:in `validate_token'
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  â†³ app/models/user.rb:80:in `set_permission'
  [1m[35m (0.5ms)[0m  [1m[35mBEGIN[0m
  â†³ app/models/user.rb:94:in `set_permission'
  [1m[36mUser Update (0.5ms)[0m  [1m[33mUPDATE `users` SET `users`.`permission_ids` = '.1.4.', `users`.`updated_at` = '2020-11-05 21:57:25' WHERE `users`.`id` = 1[0m
  â†³ app/models/user.rb:94:in `set_permission'
  [1m[35m (1.9ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/models/user.rb:94:in `set_permission'
Completed 200 OK in 34ms (Views: 0.5ms | ActiveRecord: 7.2ms | Allocations: 4871)


Started POST "/api/v3/users/set_permission" for 172.19.0.7 at 2020-11-05 13:57:28 -0800
Processing by Api::V3::UsersController#set_permission as HTML
  Parameters: {"token"=>"c656fb80045af9d1fa20104c55402a5f6cef05b9971e6d35f47409e46a767561b149e01821ef0cd96b55693b52581752cf98a4ea80ac6e106bc9714cf777a68e", "user_id"=>"1", "permission_id"=>"2", "value"=>"true"}
  [1m[36mUser Load (0.9ms)[0m  [1m[34m
        select ut.*, u.name, u.login, u.permission_ids
        from user_tokens ut
        inner join users u on u.id = ut.user_id
        where ut.token = 'c656fb80045af9d1fa20104c55402a5f6cef05b9971e6d35f47409e46a767561b149e01821ef0cd96b55693b52581752cf98a4ea80ac6e106bc9714cf777a68e' and ut.ip = '172.19.0.7'
        limit 1
      [0m
  â†³ app/models/user.rb:20:in `validate_token'
  [1m[36mPermission Load (0.6ms)[0m  [1m[34mselect * from permissions order by sort, id[0m
  â†³ app/models/permission.rb:10:in `block in permission_ids'
  [1m[35m (1.5ms)[0m  [1m[33mupdate user_tokens ut set timenow = '2020-11-05 21:57:28' where ut.token = 'c656fb80045af9d1fa20104c55402a5f6cef05b9971e6d35f47409e46a767561b149e01821ef0cd96b55693b52581752cf98a4ea80ac6e106bc9714cf777a68e' and ut.ip = '172.19.0.7' limit 1[0m
  â†³ app/models/user.rb:38:in `validate_token'
  [1m[36mUser Load (0.8ms)[0m  [1m[34mSELECT `users`.* FROM `users` WHERE `users`.`id` = 1 LIMIT 1[0m
  â†³ app/models/user.rb:80:in `set_permission'
  [1m[35m (0.6ms)[0m  [1m[35mBEGIN[0m
  â†³ app/models/user.rb:94:in `set_permission'
  [1m[36mUser Update (0.7ms)[0m  [1m[33mUPDATE `users` SET `users`.`permission_ids` = '.1.4.2.', `users`.`updated_at` = '2020-11-05 21:57:28' WHERE `users`.`id` = 1[0m
  â†³ app/models/user.rb:94:in `set_permission'
  [1m[35m (1.9ms)[0m  [1m[35mCOMMIT[0m
  â†³ app/models/user.rb:94:in `set_permission'
Completed 200 OK in 33ms (Views: 0.1ms | ActiveRecord: 7.0ms | Allocations: 4642)


Started POST "/api/v3/permissions/get_permissions" for 172.19.0.7 at 2020-11-05 13:58:15 -0800
Processing by Api::V3::PermissionsController#get_permissions as HTML
  Parameters: {"token"=>"c656fb80045af9d1fa20104c55402a5f6cef05b9971e6d35f47409e46a767561b149e01821ef0cd96b55693b52581752cf98a4ea80ac6e106bc9714cf777a68e"}
Completed 500 Internal Server Error in 6ms (ActiveRecord: 0.0ms | Allocations: 511)


  
SyntaxError (/aquarium/app/models/user.rb:42: syntax error, unexpected `end', expecting ')'
    end
    ^~~
/aquarium/app/models/user.rb:111: syntax error, unexpected `end', expecting ')'):
  
app/models/user.rb:42: syntax error, unexpected `end', expecting ')'
app/models/user.rb:111: syntax error, unexpected `end', expecting ')'
app/models/user.rb:42: syntax error, unexpected `end', expecting ')'
app/models/user.rb:111: syntax error, unexpected `end', expecting ')'
app/controllers/application_controller.rb:9:in `check_token_for_permission'
app/controllers/api/v3/permissions_controller.rb:4:in `get_permissions'
Started POST "/api/v3/permissions/get_permissions" for 172.19.0.7 at 2020-11-05 13:58:21 -0800
Processing by Api::V3::PermissionsController#get_permissions as HTML
  Parameters: {"token"=>"c656fb80045af9d1fa20104c55402a5f6cef05b9971e6d35f47409e46a767561b149e01821ef0cd96b55693b52581752cf98a4ea80ac6e106bc9714cf777a68e"}
  [1m[36mUser Load (0.7ms)[0m  [1m[34m
        select ut.*, u.name, u.login, u.permission_ids
        from user_tokens ut
        inner join users u on u.id = ut.user_id
        where ut.token = 'c656fb80045af9d1fa20104c55402a5f6cef05b9971e6d35f47409e46a767561b149e01821ef0cd96b55693b52581752cf98a4ea80ac6e106bc9714cf777a68e' and ut.ip = '172.19.0.7'
        limit 1
      [0m
  â†³ app/models/user.rb:20:in `validate_token'
  [1m[36mPermission Load (0.5ms)[0m  [1m[34mselect * from permissions order by sort, id[0m
  â†³ app/models/permission.rb:10:in `block in permission_ids'
  [1m[35m (1.3ms)[0m  [1m[33mupdate user_tokens ut set timenow = '2020-11-05 21:58:21' where ut.token = 'c656fb80045af9d1fa20104c55402a5f6cef05b9971e6d35f47409e46a767561b149e01821ef0cd96b55693b52581752cf98a4ea80ac6e106bc9714cf777a68e' and ut.ip = '172.19.0.7' limit 1[0m
  â†³ app/models/user.rb:38:in `validate_token'
Completed 200 OK in 46ms (Views: 0.1ms | ActiveRecord: 8.5ms | Allocations: 9781)


